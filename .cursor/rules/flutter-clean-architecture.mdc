# ğŸ—ï¸ Flutter Clean Architecture Rules

## ğŸš¨ Quy táº¯c nghiÃªm ngáº·t

### 1. **KHÃ”NG truy cáº­p Service tá»« Cubit/Bloc**

```dart
// âŒ VI PHáº M
class VideoAnalysisCubit extends Cubit<VideoAnalysisState> {
  final YouTubeService _youtubeService; // âŒ Truy cáº­p trá»±c tiáº¿p service
```

```dart
// âœ… ÄÃšNG
class VideoAnalysisCubit extends Cubit<VideoAnalysisState> {
  final AnalyzeVideo _analyzeVideo; // âœ… Sá»­ dá»¥ng usecase
```

### 2. **Entity Báº®T BUá»˜C sá»­ dá»¥ng Freezed**

```dart
// âœ… ÄÃšNG
@freezed
class VideoInfo with _$VideoInfo {
  const factory VideoInfo({
    required String id,
    required String title,
    required String author,
    required Duration duration,
  }) = _VideoInfo;

  factory VideoInfo.fromJson(Map<String, dynamic> json) =>
      _$VideoInfoFromJson(json);
}
```

### 3. **Model sá»­ dá»¥ng typedef hoáº·c káº¿ thá»«a Entity**

```dart
// âœ… ÄÃšNG - Typedef cho simple mapping
typedef PlaylistInfoModel = PlaylistInfo;

// âœ… ÄÃšNG - Káº¿ thá»«a cho complex mapping
class UserModel extends User {
  const UserModel({required super.id, required super.name});
  factory UserModel.fromMap(Map<String, dynamic> map) => UserModel(...);
}
```

### 4. **Repository tráº£ vá» trá»±c tiáº¿p tá»« DataSource**

```dart
// âœ… ÄÃšNG
@LazySingleton(as: DownloadRepository)
class DownloadRepositoryImpl implements DownloadRepository {
  final DownloadDataSource _dataSource;

  @override
  Future<Result<DownloadTask>> startDownload(StartDownloadParams params) async {
    try {
      final task = await _dataSource.startDownload(params);
      return Result.success(task);
    } catch (e) {
      return Result.failure('Failed to start download: $e');
    }
  }
}
```

### 5. **Sá»­ dá»¥ng Result Pattern**

```dart
// âœ… ÄÃšNG
Future<Result<VideoInfo>> analyzeVideo(String url) async {
  try {
    final videoInfo = await _dataSource.analyzeVideo(url);
    return Result.success(videoInfo);
  } catch (e) {
    return Result.failure('Failed to analyze video: $e');
  }
}
```

### 6. **Injectable Annotation**

```dart
// âœ… ÄÃšNG - UseCase
@injectable
class AnalyzeVideo {
  final VideoRepository _repository;
  AnalyzeVideo({required VideoRepository repository}) : _repository = repository;
}

// âœ… ÄÃšNG - Repository
@LazySingleton(as: VideoRepository)
class VideoRepositoryImpl implements VideoRepository {
  final VideoDataSource _dataSource;
  VideoRepositoryImpl({required VideoDataSource dataSource}) : _dataSource = dataSource;
}

// âœ… ÄÃšNG - Service
@lazySingleton
class YouTubeService {
  // Implementation
}

// âœ… ÄÃšNG - Cubit
@injectable
class VideoAnalysisCubit extends Cubit<VideoAnalysisState> {
  final AnalyzeVideo _analyzeVideo;
  VideoAnalysisCubit({required AnalyzeVideo analyzeVideo}) : _analyzeVideo = analyzeVideo;
}
```

## ğŸ“‹ Cáº¥u trÃºc thÆ° má»¥c

```
lib/
â”œâ”€â”€ core/                           # Shared components
â”‚   â”œâ”€â”€ constants/                  # App constants
â”‚   â”œâ”€â”€ error/                      # Error handling
â”‚   â”œâ”€â”€ utils/                      # Helper functions
â”‚   â”œâ”€â”€ services/                   # Platform services
â”‚   â”œâ”€â”€ result/                     # Result type
â”‚   â””â”€â”€ dependency_injection/       # DI setup
â”‚
â”œâ”€â”€ domain/                         # Business logic
â”‚   â”œâ”€â”€ entities/                   # Business entities (Báº®T BUá»˜C Freezed)
â”‚   â”œâ”€â”€ repositories/               # Repository interfaces
â”‚   â”œâ”€â”€ usecases/                   # Business use cases
â”‚   â””â”€â”€ value_objects/              # Value objects
â”‚
â”œâ”€â”€ data/                           # External data sources
â”‚   â”œâ”€â”€ models/                     # Data models (typedef hoáº·c káº¿ thá»«a entities)
â”‚   â”œâ”€â”€ datasources/                # Data sources
â”‚   â””â”€â”€ repositories/               # Repository implementations
â”‚
â””â”€â”€ presentation/                   # UI
    â”œâ”€â”€ bloc/                       # State management (Cubit/Bloc)
    â”œâ”€â”€ pages/                      # Page widgets
    â”œâ”€â”€ widgets/                    # Reusable widgets
    â””â”€â”€ theme/                      # Theme configuration
```

## ğŸ”„ Dependency Flow

```
Presentation Layer â†’ Domain Layer â† Data Layer
       â†“                    â†‘              â†‘
   UI Components    Business Logic   External Data
```

## ğŸ“ Quy trÃ¬nh táº¡o feature

### BÆ°á»›c 1: Domain Layer

1. Táº¡o Entity **Vá»šI FREEDZED** (báº¯t buá»™c)
2. Táº¡o Repository interface
3. Táº¡o UseCase

### BÆ°á»›c 2: Data Layer

1. Táº¡o Model (typedef hoáº·c káº¿ thá»«a Entity)
2. Táº¡o DataSource
3. Táº¡o Repository implementation

### BÆ°á»›c 3: Presentation Layer

1. Táº¡o Cubit/Bloc
2. Táº¡o UI components
3. Táº¡o Pages

### BÆ°á»›c 4: Dependency Injection

1. ÄÄƒng kÃ½ dependencies
2. Cháº¡y `flutter pub run build_runner build --delete-conflicting-outputs`

## ğŸ” Code Review Checklist

- [ ] **Domain layer khÃ´ng phá»¥ thuá»™c framework**
- [ ] **Entity Báº®T BUá»˜C sá»­ dá»¥ng Freezed**
- [ ] **Cubit chá»‰ sá»­ dá»¥ng UseCases**
- [ ] **Model sá»­ dá»¥ng typedef hoáº·c káº¿ thá»«a Entity**
- [ ] **Repository tráº£ vá» trá»±c tiáº¿p tá»« DataSource**
- [ ] **Sá»­ dá»¥ng Result pattern cho error handling**
- [ ] **Injectable annotation Ä‘Ãºng cÃ¡ch**
- [ ] **Dependency injection Ä‘Ã£ Ä‘Äƒng kÃ½ Ä‘áº§y Ä‘á»§**
- [ ] **Import Ä‘Ãºng layer**
- [ ] **Sá»­ dá»¥ng developer.log thay vÃ¬ print/debugPrint**

## ğŸ”§ Logging Rules

```dart
// âŒ VI PHáº M
print('Download started');
debugPrint('Download progress: $progress');

// âœ… ÄÃšNG
import 'dart:developer' as developer;
developer.log('[file_name.dart] - Download started');
developer.log('[file_name.dart] - Download progress: $progress');
```

## ğŸ¯ Injectable Rules

### Ãp dá»¥ng annotation

- **UseCase:** `@injectable`
- **Repository:** `@LazySingleton(as: XxxRepository)`
- **DataSource:** `@lazySingleton`
- **Service:** `@lazySingleton`
- **Cubit:** `@injectable`

### KhÃ´ng Ã¡p dá»¥ng

- **Entity:** Lá»›p dá»¯ liá»‡u thuáº§n vá»›i Freezed
- **Model:** Typedef hoáº·c káº¿ thá»«a entity
- **Constant:** Static fields
- **Widget/Page:** UI components

## ğŸ“š References

- [lib/domain/entities/](mdc:lib/domain/entities/) - Business entities
- [lib/domain/repositories/](mdc:lib/domain/repositories/) - Repository interfaces
- [lib/domain/usecases/](mdc:lib/domain/usecases/) - Business use cases
- [lib/data/models/](mdc:lib/data/models/) - Data models
- [lib/presentation/bloc/](mdc:lib/presentation/bloc/) - State management
